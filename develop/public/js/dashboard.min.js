var get_user = function(){
    var url = window.location.href.split('/');
    return url[url.length-1];
};
$(document).ready(function () {

    var member = {};
    var update = function(user){
        member = user;
        $('#name').val(user.name);
        $('#account_mail').val(user.account);
        $('#contact_mail').val(user.email);
        $('#IDcard').val(user.idcard);
        $('#mobile').val(user.mobile);
        $('#tel').val(user.tel);
        $('#current_bonus').html(user.bonus);
        $('#tmp_bonus').html(user.tmp_bonus);
    };

    $.ajax({
        url: '/api/ease/member/'+get_user(),
        method: 'GET',
        dataType: 'json',
        success: function (a) {
            update(a.data);
        },
        error: function (a) {
            console.log(a);
        },
    });

    $('#update').on('click', function () {
        var condition = false, data = {};

        $('#tel').val() != member.tel && (data['tel'] = $('#tel').val(), condition = true);
        $('#contact_mail').val() != member.email && (data['email'] = $('#contact_mail').val(), condition = true);
        $('#mobile').val() != member.mobile && (data['mobile'] = $('#mobile').val(), condition = true);

        if(condition){
            $.ajax({
                url: '/api/ease/member/edit',
                method: 'PUT',
                dataType: 'json',
                data: data,
                success: function (a) {
                    $.growl.notice({message: 'success'});
                    update(a.data);
                },
                error: function (a) {
                    console.log(a);
                },
            });
        }else
            $.growl.warning({message: 'nothing change'});
    });

    $('#password-modal').on('click', function () {
        $('#password_modal').modal({
            backdrop: 'static',
            keyboard: true,
            show: true
        });
    });

    $('#change_pwd').on('click', function () {
        if( $('#password').val() == $('#password2').val()){
            $.ajax({
                url: '/api/ease/member/edit',
                method: 'PUT',
                dataType: 'json',
                data: {'password' : $('#password').val()},
                success: function (a) {
                    $.growl.notice({message: 'success'});
                    $('#password').val('');
                    $('#password2').val('');
                    $('#password_modal').modal('hide');
                },
                error: function (a) {
                    console.log(a);
                },
            });
        }else{
            $.growl.error({message: 'different'});
        }

    });

});
